<!--
   
   Copyright (c) 2017, the Perspective Authors.
   
   This file is part of the Perspective library, distributed under the terms of
   the Apache License 2.0.  The full license can be found in the LICENSE file.

-->

<!DOCTYPE html>
<html>

<head>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">

    <script src="http://localhost:8080/node_modules/perspective-viewer/dist/umd/perspective-viewer.js"></script>
    <script src="http://localhost:8080/node_modules/perspective-viewer-datagrid/dist/umd/perspective-viewer-datagrid.js"></script>
    <script src="http://localhost:8080/node_modules/perspective-viewer-d3fc/dist/umd/perspective-viewer-d3fc.js"></script>
    <script src="http://localhost:8080/node_modules/perspective/dist/umd/perspective.js"></script>

    <link rel='stylesheet' href="http://localhost:8080/node_modules/perspective-viewer/dist/umd/material-dense.css">

    <style>
        perspective-viewer{position:absolute;top:0;left:0;right:0;bottom:0;}
    </style>

</head>

<body>
    <perspective-viewer 
        id="viewer">
    
    </perspective-viewer>

    <script>
var SECURITIES = [
    "AAPL.N",
    "AMZN.N",
    "QQQ.N",
    "NVDA.N",
    "TSLA.N",
    "FB.N",
    "MSFT.N",
    "TLT.N",
    "XIV.N",
    "YY.N",
    "CSCO.N",
    "GOOGL.N",
    "PCLN.N",
];

var CLIENTS = [
    "Homer",
    "Marge",
    "Bart",
    "Lisa",
    "Maggie",
    "Moe",
    "Lenny",
    "Carl",
    "Krusty",
];

// Create 5 random rows of data.
function newRows() {
    var rows = [];
    for (var x = 0; x < 50; x++) {
        rows.push({
            name: SECURITIES[Math.floor(Math.random() * SECURITIES.length)],
            client: CLIENTS[Math.floor(Math.random() * CLIENTS.length)],
            lastUpdate: new Date(),
            chg: Math.random() * 20 - 10,
            bid: Math.random() * 10 + 90,
            ask: Math.random() * 10 + 100,
            vol: Math.random() * 10 + 100,
        });
    }
    return rows;
}

window.addEventListener("DOMContentLoaded", async function () {
    // Get element from the DOM.
    var elem = document.getElementsByTagName("perspective-viewer")[0];

    // Create a new Perspective WebWorker instance.
    var worker = perspective.worker();

    // Create a new Perspective table in our `worker`, and limit it it 500 rows.
    var table = await worker.table(newRows(), {
        limit: 10,
    });
    
    const view = await table.view({
        columns: ["(-)chg", "chg", "(+)chg"],
        expressions: [
            '//(-)chg\nif("chg"<0){"chg"}else{0}',
            '//(+)chg\nif("chg">0){"chg"}else{0}',
        ],
    });

    // // Load the `table` in the `<perspective-viewer>` DOM reference.
    // await elem.load(Promise.resolve(table));

    // elem.restore({
    //     plugin: "Datagrid",
    //     columns: ["(-)chg", "chg", "(+)chg"],
    //     expressions: [
    //         '//(-)chg\nif("chg"<0){"chg"}else{0}',
    //         '//(+)chg\nif("chg">0){"chg"}else{0}',
    //     ],
    //     row_pivots: ["name"],
    //     column_pivots: ["client"],
    //     aggregates: {"(-)chg": "avg", "(+)chg": "avg", chg: "avg"},
    //     sort: [["chg", "desc"]],
    //     plugin_config: {
    //         "(-)chg": {
    //             color_mode: "bar",
    //             gradient: 10,
    //         },
    //         "(+)chg": {
    //             color_mode: "bar",
    //             gradient: 10,
    //         },
    //         chg: {
    //             color_mode: "gradient",
    //             gradient: 10,
    //         },
    //     },
    // });

    // Add more rows every 50ms using the `update()` method on the `table` directly.
    // (function postRow() {
    //     table.update(newRows());
    //     setTimeout(postRow, 250);
    // })();
});

    </script>

</body>

</html>